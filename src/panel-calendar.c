/* panel-calendar.c generated by valac 0.26.1, the Vala compiler
 * generated from panel-calendar.vala, do not modify */


#include <glib.h>
#include <glib-object.h>
#include <gtk/gtk.h>
#include <gdk/gdk.h>
#include <glib/gi18n-lib.h>
#include <gio/gdesktopappinfo.h>
#include <gio/gio.h>


#define TYPE_PANEL_ABSTRACT_WINDOW (panel_abstract_window_get_type ())
#define PANEL_ABSTRACT_WINDOW(obj) (G_TYPE_CHECK_INSTANCE_CAST ((obj), TYPE_PANEL_ABSTRACT_WINDOW, PanelAbstractWindow))
#define PANEL_ABSTRACT_WINDOW_CLASS(klass) (G_TYPE_CHECK_CLASS_CAST ((klass), TYPE_PANEL_ABSTRACT_WINDOW, PanelAbstractWindowClass))
#define IS_PANEL_ABSTRACT_WINDOW(obj) (G_TYPE_CHECK_INSTANCE_TYPE ((obj), TYPE_PANEL_ABSTRACT_WINDOW))
#define IS_PANEL_ABSTRACT_WINDOW_CLASS(klass) (G_TYPE_CHECK_CLASS_TYPE ((klass), TYPE_PANEL_ABSTRACT_WINDOW))
#define PANEL_ABSTRACT_WINDOW_GET_CLASS(obj) (G_TYPE_INSTANCE_GET_CLASS ((obj), TYPE_PANEL_ABSTRACT_WINDOW, PanelAbstractWindowClass))

typedef struct _PanelAbstractWindow PanelAbstractWindow;
typedef struct _PanelAbstractWindowClass PanelAbstractWindowClass;
typedef struct _PanelAbstractWindowPrivate PanelAbstractWindowPrivate;

#define TYPE_PANEL_CALENDAR (panel_calendar_get_type ())
#define PANEL_CALENDAR(obj) (G_TYPE_CHECK_INSTANCE_CAST ((obj), TYPE_PANEL_CALENDAR, PanelCalendar))
#define PANEL_CALENDAR_CLASS(klass) (G_TYPE_CHECK_CLASS_CAST ((klass), TYPE_PANEL_CALENDAR, PanelCalendarClass))
#define IS_PANEL_CALENDAR(obj) (G_TYPE_CHECK_INSTANCE_TYPE ((obj), TYPE_PANEL_CALENDAR))
#define IS_PANEL_CALENDAR_CLASS(klass) (G_TYPE_CHECK_CLASS_TYPE ((klass), TYPE_PANEL_CALENDAR))
#define PANEL_CALENDAR_GET_CLASS(obj) (G_TYPE_INSTANCE_GET_CLASS ((obj), TYPE_PANEL_CALENDAR, PanelCalendarClass))

typedef struct _PanelCalendar PanelCalendar;
typedef struct _PanelCalendarClass PanelCalendarClass;
typedef struct _PanelCalendarPrivate PanelCalendarPrivate;
#define _g_object_unref0(var) ((var == NULL) ? NULL : (var = (g_object_unref (var), NULL)))
typedef struct _Block9Data Block9Data;
#define _g_error_free0(var) ((var == NULL) ? NULL : (var = (g_error_free (var), NULL)))

struct _PanelAbstractWindow {
	GtkWindow parent_instance;
	PanelAbstractWindowPrivate * priv;
};

struct _PanelAbstractWindowClass {
	GtkWindowClass parent_class;
};

struct _PanelCalendar {
	PanelAbstractWindow parent_instance;
	PanelCalendarPrivate * priv;
};

struct _PanelCalendarClass {
	PanelAbstractWindowClass parent_class;
};

struct _PanelCalendarPrivate {
	GtkCalendar* calendar;
	GtkButton* button;
};

struct _Block9Data {
	int _ref_count_;
	PanelCalendar* self;
	GtkMessageDialog* dialog;
};


static gpointer panel_calendar_parent_class = NULL;

GType panel_abstract_window_get_type (void) G_GNUC_CONST;
GType panel_calendar_get_type (void) G_GNUC_CONST;
#define PANEL_CALENDAR_GET_PRIVATE(o) (G_TYPE_INSTANCE_GET_PRIVATE ((o), TYPE_PANEL_CALENDAR, PanelCalendarPrivate))
enum  {
	PANEL_CALENDAR_DUMMY_PROPERTY
};
#define PANEL_CALENDAR_PADDING 5
PanelCalendar* panel_calendar_new (void);
PanelCalendar* panel_calendar_construct (GType object_type);
PanelAbstractWindow* panel_abstract_window_new (void);
PanelAbstractWindow* panel_abstract_window_construct (GType object_type);
void panel_screen_move_window (GtkWindow* window, GdkGravity gravity);
static void __lambda40_ (PanelCalendar* self);
static Block9Data* block9_data_ref (Block9Data* _data9_);
static void block9_data_unref (void * _userdata_);
static void ___lambda41_ (Block9Data* _data9_);
static void ____lambda41__gtk_dialog_response (GtkDialog* _sender, gint response_id, gpointer self);
static void ___lambda40__gtk_button_clicked (GtkButton* _sender, gpointer self);
static void panel_calendar_real_get_preferred_width (GtkWidget* base, gint* min, gint* max);
static void panel_calendar_real_get_preferred_height (GtkWidget* base, gint* min, gint* max);
static gboolean panel_calendar_real_hide (PanelCalendar* self);
void panel_calendar_try_hide (PanelCalendar* self);
static gboolean _panel_calendar_real_hide_gsource_func (gpointer self);
void panel_calendar_update_position (PanelCalendar* self, gint y);
void panel_screen_get_primary_monitor_geometry (GdkRectangle* result);
static void panel_calendar_finalize (GObject* obj);


static Block9Data* block9_data_ref (Block9Data* _data9_) {
	g_atomic_int_inc (&_data9_->_ref_count_);
	return _data9_;
}


static void block9_data_unref (void * _userdata_) {
	Block9Data* _data9_;
	_data9_ = (Block9Data*) _userdata_;
	if (g_atomic_int_dec_and_test (&_data9_->_ref_count_)) {
		PanelCalendar* self;
		self = _data9_->self;
		_g_object_unref0 (_data9_->dialog);
		_g_object_unref0 (self);
		g_slice_free (Block9Data, _data9_);
	}
}


static void ___lambda41_ (Block9Data* _data9_) {
	PanelCalendar* self;
	GtkMessageDialog* _tmp0_ = NULL;
	self = _data9_->self;
	_tmp0_ = _data9_->dialog;
	gtk_widget_destroy ((GtkWidget*) _tmp0_);
}


static void ____lambda41__gtk_dialog_response (GtkDialog* _sender, gint response_id, gpointer self) {
	___lambda41_ (self);
}


static void __lambda40_ (PanelCalendar* self) {
	GDesktopAppInfo* info = NULL;
	GDesktopAppInfo* _tmp0_ = NULL;
	GError * _inner_error_ = NULL;
	_tmp0_ = g_desktop_app_info_new_from_filename ("/usr/share/applications/gnome-datetime-panel.desktop");
	info = _tmp0_;
	{
		GAppLaunchContext* _tmp1_ = NULL;
		GAppLaunchContext* _tmp2_ = NULL;
		_tmp1_ = g_app_launch_context_new ();
		_tmp2_ = _tmp1_;
		g_app_info_launch ((GAppInfo*) info, NULL, _tmp2_, &_inner_error_);
		_g_object_unref0 (_tmp2_);
		if (G_UNLIKELY (_inner_error_ != NULL)) {
			goto __catch32_g_error;
		}
	}
	goto __finally32;
	__catch32_g_error:
	{
		GError* e = NULL;
		Block9Data* _data9_;
		const gchar* _tmp3_ = NULL;
		GError* _tmp4_ = NULL;
		const gchar* _tmp5_ = NULL;
		GtkMessageDialog* _tmp6_ = NULL;
		GtkMessageDialog* _tmp7_ = NULL;
		GtkMessageDialog* _tmp8_ = NULL;
		e = _inner_error_;
		_inner_error_ = NULL;
		_data9_ = g_slice_new0 (Block9Data);
		_data9_->_ref_count_ = 1;
		_data9_->self = g_object_ref (self);
		_tmp3_ = _ ("Unable to launch date-time applet: %s");
		_tmp4_ = e;
		_tmp5_ = _tmp4_->message;
		_tmp6_ = (GtkMessageDialog*) gtk_message_dialog_new (NULL, GTK_DIALOG_DESTROY_WITH_PARENT, GTK_MESSAGE_ERROR, GTK_BUTTONS_CLOSE, _tmp3_, _tmp5_);
		g_object_ref_sink (_tmp6_);
		_data9_->dialog = _tmp6_;
		_tmp7_ = _data9_->dialog;
		g_signal_connect_data ((GtkDialog*) _tmp7_, "response", (GCallback) ____lambda41__gtk_dialog_response, block9_data_ref (_data9_), (GClosureNotify) block9_data_unref, 0);
		_tmp8_ = _data9_->dialog;
		gtk_widget_show ((GtkWidget*) _tmp8_);
		_g_error_free0 (e);
		block9_data_unref (_data9_);
		_data9_ = NULL;
	}
	__finally32:
	if (G_UNLIKELY (_inner_error_ != NULL)) {
		_g_object_unref0 (info);
		g_critical ("file %s: line %d: uncaught error: %s (%s, %d)", __FILE__, __LINE__, _inner_error_->message, g_quark_to_string (_inner_error_->domain), _inner_error_->code);
		g_clear_error (&_inner_error_);
		return;
	}
	gtk_widget_hide ((GtkWidget*) self);
	_g_object_unref0 (info);
}


static void ___lambda40__gtk_button_clicked (GtkButton* _sender, gpointer self) {
	__lambda40_ ((PanelCalendar*) self);
}


PanelCalendar* panel_calendar_construct (GType object_type) {
	PanelCalendar * self = NULL;
	GtkCalendar* _tmp0_ = NULL;
	GtkVBox* box = NULL;
	GtkVBox* _tmp1_ = NULL;
	GtkCalendar* _tmp2_ = NULL;
	const gchar* _tmp3_ = NULL;
	GtkButton* _tmp4_ = NULL;
	GtkButton* _tmp5_ = NULL;
	GtkButton* _tmp6_ = NULL;
	GtkButton* _tmp7_ = NULL;
	self = (PanelCalendar*) panel_abstract_window_construct (object_type);
	_tmp0_ = (GtkCalendar*) gtk_calendar_new ();
	g_object_ref_sink (_tmp0_);
	_g_object_unref0 (self->priv->calendar);
	self->priv->calendar = _tmp0_;
	_tmp1_ = (GtkVBox*) gtk_vbox_new (FALSE, PANEL_CALENDAR_PADDING);
	g_object_ref_sink (_tmp1_);
	box = _tmp1_;
	gtk_container_add ((GtkContainer*) self, (GtkWidget*) box);
	_tmp2_ = self->priv->calendar;
	gtk_box_pack_start ((GtkBox*) box, (GtkWidget*) _tmp2_, FALSE, FALSE, (guint) 0);
	panel_screen_move_window ((GtkWindow*) self, GDK_GRAVITY_NORTH_EAST);
	_tmp3_ = _ ("Adjust date/time");
	_tmp4_ = (GtkButton*) gtk_button_new_with_label (_tmp3_);
	g_object_ref_sink (_tmp4_);
	_g_object_unref0 (self->priv->button);
	self->priv->button = _tmp4_;
	_tmp5_ = self->priv->button;
	gtk_box_pack_start ((GtkBox*) box, (GtkWidget*) _tmp5_, FALSE, FALSE, (guint) 0);
	_tmp6_ = self->priv->button;
	gtk_widget_show ((GtkWidget*) _tmp6_);
	_tmp7_ = self->priv->button;
	g_signal_connect_object (_tmp7_, "clicked", (GCallback) ___lambda40__gtk_button_clicked, self, 0);
	_g_object_unref0 (box);
	return self;
}


PanelCalendar* panel_calendar_new (void) {
	return panel_calendar_construct (TYPE_PANEL_CALENDAR);
}


static void panel_calendar_real_get_preferred_width (GtkWidget* base, gint* min, gint* max) {
	PanelCalendar * self;
	gint _vala_min = 0;
	gint _vala_max = 0;
	GtkCalendar* _tmp0_ = NULL;
	gint _tmp1_ = 0;
	gint _tmp2_ = 0;
	self = (PanelCalendar*) base;
	_tmp0_ = self->priv->calendar;
	gtk_widget_get_preferred_width ((GtkWidget*) _tmp0_, &_tmp1_, &_tmp2_);
	_vala_min = _tmp1_;
	_vala_max = _tmp2_;
	if (min) {
		*min = _vala_min;
	}
	if (max) {
		*max = _vala_max;
	}
}


static void panel_calendar_real_get_preferred_height (GtkWidget* base, gint* min, gint* max) {
	PanelCalendar * self;
	gint _vala_min = 0;
	gint _vala_max = 0;
	gint h1 = 0;
	gint h2 = 0;
	GtkCalendar* _tmp0_ = NULL;
	gint _tmp1_ = 0;
	gint _tmp2_ = 0;
	gint _tmp3_ = 0;
	gint _tmp4_ = 0;
	GtkButton* _tmp5_ = NULL;
	gint _tmp6_ = 0;
	gint _tmp7_ = 0;
	gint _tmp8_ = 0;
	gint _tmp9_ = 0;
	gint _tmp10_ = 0;
	gint _tmp11_ = 0;
	self = (PanelCalendar*) base;
	_tmp0_ = self->priv->calendar;
	gtk_widget_get_preferred_height ((GtkWidget*) _tmp0_, &_tmp1_, &_tmp2_);
	h1 = _tmp1_;
	h2 = _tmp2_;
	_tmp3_ = h1;
	_vala_min = _tmp3_;
	_tmp4_ = h2;
	_vala_max = _tmp4_;
	_tmp5_ = self->priv->button;
	gtk_widget_get_preferred_height ((GtkWidget*) _tmp5_, &_tmp6_, &_tmp7_);
	h1 = _tmp6_;
	h2 = _tmp7_;
	_tmp8_ = _vala_min;
	_tmp9_ = h1;
	_vala_min = _tmp8_ + (_tmp9_ + PANEL_CALENDAR_PADDING);
	_tmp10_ = _vala_max;
	_tmp11_ = h2;
	_vala_max = _tmp10_ + (_tmp11_ + PANEL_CALENDAR_PADDING);
	if (min) {
		*min = _vala_min;
	}
	if (max) {
		*max = _vala_max;
	}
}


static gboolean panel_calendar_real_hide (PanelCalendar* self) {
	gboolean result = FALSE;
	g_return_val_if_fail (self != NULL, FALSE);
	gtk_widget_hide ((GtkWidget*) self);
	result = FALSE;
	return result;
}


static gboolean _panel_calendar_real_hide_gsource_func (gpointer self) {
	gboolean result;
	result = panel_calendar_real_hide ((PanelCalendar*) self);
	return result;
}


void panel_calendar_try_hide (PanelCalendar* self) {
	g_return_if_fail (self != NULL);
	g_timeout_add_full (G_PRIORITY_DEFAULT, (guint) 500, _panel_calendar_real_hide_gsource_func, g_object_ref (self), g_object_unref);
	g_signal_emit_by_name (self, "dismissed");
}


void panel_calendar_update_position (PanelCalendar* self, gint y) {
	GdkRectangle g = {0};
	GdkRectangle _tmp0_ = {0};
	gint min = 0;
	gint max = 0;
	GtkCalendar* _tmp1_ = NULL;
	gint _tmp2_ = 0;
	gint _tmp3_ = 0;
	GdkRectangle _tmp4_ = {0};
	gint _tmp5_ = 0;
	GdkRectangle _tmp6_ = {0};
	gint _tmp7_ = 0;
	GdkRectangle _tmp8_ = {0};
	gint _tmp9_ = 0;
	gint _tmp10_ = 0;
	g_return_if_fail (self != NULL);
	panel_screen_get_primary_monitor_geometry (&_tmp0_);
	g = _tmp0_;
	_tmp1_ = self->priv->calendar;
	gtk_widget_get_preferred_width ((GtkWidget*) _tmp1_, &_tmp2_, &_tmp3_);
	min = _tmp2_;
	max = _tmp3_;
	gtk_widget_queue_resize ((GtkWidget*) self);
	_tmp4_ = g;
	_tmp5_ = _tmp4_.x;
	_tmp6_ = g;
	_tmp7_ = _tmp6_.width;
	_tmp8_ = g;
	_tmp9_ = _tmp8_.y;
	_tmp10_ = y;
	gtk_window_move ((GtkWindow*) self, _tmp5_ + (_tmp7_ - max), _tmp9_ + _tmp10_);
}


static void panel_calendar_class_init (PanelCalendarClass * klass) {
	panel_calendar_parent_class = g_type_class_peek_parent (klass);
	g_type_class_add_private (klass, sizeof (PanelCalendarPrivate));
	((GtkWidgetClass *) klass)->get_preferred_width = panel_calendar_real_get_preferred_width;
	((GtkWidgetClass *) klass)->get_preferred_height = panel_calendar_real_get_preferred_height;
	G_OBJECT_CLASS (klass)->finalize = panel_calendar_finalize;
	g_signal_new ("dismissed", TYPE_PANEL_CALENDAR, G_SIGNAL_RUN_LAST, 0, NULL, NULL, g_cclosure_marshal_VOID__VOID, G_TYPE_NONE, 0);
	g_signal_new ("shown", TYPE_PANEL_CALENDAR, G_SIGNAL_RUN_LAST, 0, NULL, NULL, g_cclosure_marshal_VOID__VOID, G_TYPE_NONE, 0);
	g_signal_new ("about_to_show_content", TYPE_PANEL_CALENDAR, G_SIGNAL_RUN_LAST, 0, NULL, NULL, g_cclosure_marshal_VOID__VOID, G_TYPE_NONE, 0);
}


static void panel_calendar_instance_init (PanelCalendar * self) {
	self->priv = PANEL_CALENDAR_GET_PRIVATE (self);
}


static void panel_calendar_finalize (GObject* obj) {
	PanelCalendar * self;
	self = G_TYPE_CHECK_INSTANCE_CAST (obj, TYPE_PANEL_CALENDAR, PanelCalendar);
	_g_object_unref0 (self->priv->calendar);
	_g_object_unref0 (self->priv->button);
	G_OBJECT_CLASS (panel_calendar_parent_class)->finalize (obj);
}


GType panel_calendar_get_type (void) {
	static volatile gsize panel_calendar_type_id__volatile = 0;
	if (g_once_init_enter (&panel_calendar_type_id__volatile)) {
		static const GTypeInfo g_define_type_info = { sizeof (PanelCalendarClass), (GBaseInitFunc) NULL, (GBaseFinalizeFunc) NULL, (GClassInitFunc) panel_calendar_class_init, (GClassFinalizeFunc) NULL, NULL, sizeof (PanelCalendar), 0, (GInstanceInitFunc) panel_calendar_instance_init, NULL };
		GType panel_calendar_type_id;
		panel_calendar_type_id = g_type_register_static (TYPE_PANEL_ABSTRACT_WINDOW, "PanelCalendar", &g_define_type_info, 0);
		g_once_init_leave (&panel_calendar_type_id__volatile, panel_calendar_type_id);
	}
	return panel_calendar_type_id__volatile;
}



